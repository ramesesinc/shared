<workunit>
    <invokers>
        <invoker type="toolbar" icon="images/toolbars/barcode_global.png" caption="" 
            action="init" target="popup" permission="system" windowmode="glasspane" 
            tooltip="Barcode Search" index="-17"/> 
            
        <invoker type="barcode" icon="images/toolbars/barcode.png" caption="Barcode" 
            action="init" target="popup" permission="system" windowmode="glasspane"/>
    </invokers>
    
    <code>
    <![CDATA[    
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        
        class BarcodeSearchController 
        { 
            @Binding
            def binding;
            
            @FormTitle
            def formTitle = "Barcode Search"; 
        
            def prefix;
            String barcode;
            
            void init() { 
                barcode = null; 
            }
            
            def search() {                 
                if (barcode == null || barcode.length() <= 5) return null; 
                
                def prefixid = barcode.substring(0,5); 
                def barcodeid = barcode.substring(6);
                if (prefix != null) prefixid = prefix;

                try { 
                    def opener = InvokerUtil.lookupOpener('global:barcode:'+ prefixid, [barcodeid: barcodeid]); 
                    opener.properties.closeBehindOnStart = true;
                    return opener;
                } catch(e) { 
                    MsgBox.err('No appropriate handler found for this particular barcode. [global:barcode:'+prefixid+']-> '+ barcodeid);
                    return null; 
                } 
            } 
            
            def cancel() {
                return '_close';
            } 
        }
    ]]>
    </code>
    
    <pages>
        <page template="system.tools.ui.BarcodeSearchPage"/> 
    </pages>
    
</workunit>
