<workunit>
    <invokers>
    </invokers>
    <code>
        <![CDATA[
        
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*
        import com.rameses.osiris2.reports.*;
        
        class RuleMgmtController extends DefaultListController {
           
            @Service("RuleMgmtService")
            def service;
            
            @Script("Template")
            def template;
            
            def ruleHtml;
            def rulegroups;
            def rulestates;
            String entityName = "rulemgmt";
            String formName = 'rulemgmt';
            def ruleset;
            
            @PropertyChangeListener
            def listener = [
                "query.(rulegroup|state|title)": {o->
                    reload();
                }
            ]
            
            public String getRuleHtml() {
                if(!selectedEntity) return  "";
                def o = selectedEntity;
                if( !o.ruleHtml ) {
                    def z = service.open( [objid: o.objid] );
                    o.ruleHtml = template.render( "html/rule_html", [rule: z, editable:false] );
                }
                return o.ruleHtml;
            }
            
            void init() {
               ruleset = tag;
               query.ruleset = tag;
               rulegroups = service.getRulegroups([ruleset:query.ruleset]);
               rulestates = [ "DRAFT", "DEPLOYED", "APPROVED"];
            }
            
            void search() {
                reload();
            }
            
            boolean getDebug() {
                def d =  OsirisContext.clientContext.appEnv['app.debug'];
                if(!d) return false;
                return d;
            }
            
        }
        ]]>
    </code>
    <pages>
        <page template="com.rameses.rulemgmt.RuleListPage"/>
        <page name="queryform" template="com.rameses.rulemgmt.RuleMgmtQuery"/>
    </pages>
</workunit>
