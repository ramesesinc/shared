<workunit>
    <invokers>
        <invoker type="afrequest:create" caption="AF Requisition" action="create" target="window"/>
        <invoker folderid="/txn/treasury" action="create" caption="Request Accountable Form" target="window"/>

        <!--
        <invoker type="navActions" action="addReceipt" caption="Add Receipt" />
        -->
        <invoker type="formActions" action="start" caption="Next" />
    </invokers>
    
    <code>
        <![CDATA[
        
            import com.rameses.rcp.annotations.*
            import com.rameses.rcp.common.*
            import com.rameses.osiris2.client.*
            import com.rameses.osiris2.common.*

            class AFRequestController {

                @Service("AFRequestService")
                def afrequestSvc;
                
                String title = "AF Request";
                
                def entity;
                def requestTypes;
                def requestType;
                
                def selectedItem;
                boolean showall = true;
                def mode = "create";
                
                def create() {
                   entity =  [items:[]];
                   requestTypes = InvokerUtil.lookupOpeners( "afrequest:type", [entity: entity ]);
                   return "initial";
                }
                
                def start() {
                    entity.txntype = requestType.caption; 
                    return "newpage";
                }

                def reqItemModel = [
                    fetchList: {o->
                        entity.items;
                    }
                ] as BasicListModel;

                
                def addReqItem() {
                    return InvokerUtil.lookupOpener( "afrequest:additem", 
                        [  entity: entity,
                           saveHandler: { 
                              reqItemModel.reload();
                           }
                         ]
                     );
                }
            }
            
     ]]>
    </code>
    
    <pages>
        <page name="initial" template="com.rameses.gov.treasury.af.AFRequestInitialPage"/>
        <page name="newpage" template="com.rameses.gov.treasury.af.AFRequestPage"/>
    </pages>
</workunit>