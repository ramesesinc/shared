<workunit>
    <invokers>
        <invoker folderid="/explorer/txn/treasury" caption="AF Inventory" action="init"/>
        <invoker type="formActions" caption="Close" action="_close" role="AFO"/>
    </invokers>
    
    <code>
        <![CDATA[    
        import com.rameses.osiris2.common.*;
        import com.rameses.rcp.common.*;
        import com.rameses.rcp.annotations.*;
        import java.rmi.server.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.util.*;
        import com.rameses.osiris2.reports.*;
        
        class AFInventoryController {
        
            String title = "Accountable Form Inventory";
        
            @Service("AFInventoryService")
            def inventorySvc;
        
            @Service("AFService")
            def afSvc;    
            
            def afType;
            def afTypes;
            def selectedItem;
            
            @PropertyChangeListener
            def listener = [
                afType: { o->
                    listModel.reload();
                }
            ]
            
            public void init() {
                afTypes = afSvc.getTypes();
            }
            
            def listModel = [
                fetchList: { o->    
                    if(!afType) return [];
                    o.afid = afType.af;
                    return inventorySvc.getList(o);
                }
            ] as BasicListModel;
         
             def detailModel = [
                fetchList: { o->    
                    if(!selectedItem) return [];
                    o.controlid = selectedItem.objid;
                    return inventorySvc.getDetails(o);
                }
            ] as BasicListModel;
            
        }
        ]]>
    </code>
    <pages>
        <page template="com.rameses.gov.treasury.af.AFInventoryPage"/>
    </pages>
</workunit>