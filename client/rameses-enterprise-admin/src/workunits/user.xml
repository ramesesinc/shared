<workunit serviceName="UserAdminService" entityName="user">
    <invokers>
        <invoker type="user:create" action="init" caption="User Information" resizable="false"/>
        <invoker type="user:open" action="open" caption="User Information" resizable="false"/>

        <!-- extended actions -->
        <invoker type="extActions" caption="Reset Password" action="resetPassword"  
            visibleWhen="#{mode=='read'}" resizable="false" /> 
    </invokers>
   
    <code>
    <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import java.rmi.server.*;

        public class UserController extends BasicCRUDController {
            String prefixId = "USR";
         
            def selectedUsergroup;
            def pwd = [:];
        
            def resetPassword() {
                return InvokerUtil.lookupOpener("user:resetpwd", [entity:entity]);
            }
            
            def addUsergroup() { 
                def params = [
                    entity:[objid:"UGM"+ new UID(), user: entity], 
                    view: 'user',
                    saveHandler:{ o->
                        if( !entity.usergroups ) entity.usergroups = [];
                        entity.usergroups << o; 
                        usergroupHandler.reload(); 
                    }
                ]; 
                return InvokerUtil.lookupOpener('usergroup:add', params); 
            } 
            
            def editUsergroup() { 
                if(!selectedUsergroup) return;
                def params = [
                    view: 'user',
                    entity: selectedUsergroup
                ];
                return InvokerUtil.lookupOpener( 'usergroup:edit', params );
            }
            
            
            void removeUsergroup() { 
                if(!selectedUsergroup) return;
                service.removeUsergroup(selectedUsergroup);
                entity.usergroups.remove(selectedUsergroup);
                usergroupHandler.reload(); 
            }
            
            def usergroupHandler = [
                fetchList: { 
                    return entity?.usergroups; 
                }
            ] as BasicListModel;
            
            void entityChanged() {
                usergroupHandler.reload(); 
            }

        }
        
       ]]>
   </code>
   <pages>
       <page template="com.rameses.admin.user.UserPage"/>
   </pages>
</workunit>