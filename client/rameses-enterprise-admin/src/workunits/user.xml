<workunit serviceName="UserAdminService" entityName="user">
    <invokers>
        <invoker type="user:create" action="init" caption="User Information" resizable="false"/>
        <invoker type="user:open" action="open" caption="User Information" resizable="false"/>

        <!-- extended actions -->
        <invoker type="extActions" caption="Reset Password" action="resetPassword"  
            visibleWhen="#{mode=='read'}" resizable="false" /> 
        <invoker type="extActions" caption="User Group" action="openUsergroupMgmt" 
            visibleWhen="#{mode=='read'}"/> 
    </invokers>
   
    <code>
    <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;

        public class UserController extends BasicCRUDController {
            String prefixId = "USR";
         
            def pwd = [:];
        
            def resetPassword() {
                return InvokerUtil.lookupOpener("user:resetpwd", [entity:entity]);
            }
            
            def addUsergroup() { 
                def params = [entity:entity, handler:{ 
                    entity.usergroups = service.getUsergroups([objid: entity.objid]); 
                    usergroupHandler.reload(); 
                }]; 
                return InvokerUtil.lookupOpener('user-usergroup:add', params); 
            } 
            
            def usergroupHandler = [
                fetchList: { 
                    return entity?.usergroups; 
                }
            ] as BasicListModel;
            
            void entityChanged() {
                usergroupHandler.reload(); 
            }
            
            def openUsergroupMgmt() {
                def params = [
                    entity:entity, 
                    handler:{ 
                        entity.usergroups = service.getUsergroups([objid: entity.objid]); 
                        usergroupHandler.reload(); 
                    }
                ];             
                return InvokerUtil.lookupOpener('user-usergroupmgmt:open', params); 
            } 
        }
        
       ]]>
   </code>
   <pages>
       <page template="com.rameses.admin.user.UserPage"/>
   </pages>
</workunit>