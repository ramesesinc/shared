<workunit>
    <invokers>
        <invoker type="ruleset:create" caption="New ruleset" action="create" target="window"/>
        <invoker type="ruleset:open" caption="Open ruleset"  action="open" target="window"/>
        
        <invoker type="formActions" caption="Save" action="saveNew" visibleWhen="#{mode=='create'}"/>
    </invokers>
    
    <code>
        <![CDATA[    

        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        
        class  RulesetDevController  {
            
            @Service("RulesetDevService")
            def devSvc;
        
            def entity;
            def title = "Ruleset";
            def mode = "create";
            
            def ruleElements;
            def ruleElement;
            
            void open() {
                ruleElements = InvokerUtil.lookupOpeners("ruleelement:list",["query.ruleset":entity.name]);
                if(ruleElements) ruleElement = ruleElements[0];
                entity = devSvc.open( entity );
                mode = "edit";
            }
            
            def create() {
                entity = [:];
                return "initial"
            }

            def saveNew() {
                entity = devSvc.create(entity);
                mode = "read";
                ruleElements = InvokerUtil.lookupOpeners("ruleelement:list",["query.ruleset":entity.name]);
                return "default";
            }
            
            void saveUpdate() {
                entity = devSvc.update(entity);
                mode = "read";
            }

        }
        
        
        ]]>
        
    </code>
    <pages>
        <page name="initial" template="com.rameses.rules.dev.RulesetInitialPage"/>
        <page template="com.rameses.rules.dev.RulesetPage"/>
    </pages>
</workunit>