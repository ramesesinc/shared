<workunit>
    <invokers>
        <invoker type="ruleset:plugins" permission="system" caption=" Rule Groups   " index="-10"/>
    </invokers>
   
    <code>
    <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;

        public class RuleGroupsController 
        {
            //feed by the caller 
            def entity;
        
            @Service('RuleGroupService') 
            def service;
            
            def selectedRulegroup;
            def rulegroupHandler = [
                fetchList: { 
                    if (entity.rulegroups == null) 
                        entity.rulegroups = service.getList([ruleset: entity.name]); 
                        
                    return entity.rulegroups; 
                }, 
                onRemoveItem: {
                    return removeRulegroupImpl();  
                },
                getOpenerParams: {
                    return [
                        rulegroupHandler: rulegroupHandler, 
                        closeAfterSave: true, 
                        ruleset: entity, 
                        rulegroup: selectedRulegroup 
                    ];
                } 
            ] as BasicListModel;

            def removeRulegroup() {
                removeRulegroupImpl();
                rulegroupHandler.reload();
            }
            
            def addRulegroup() {
                def params = [
                    rulegroupHandler: rulegroupHandler, 
                    closeAfterSave: true, 
                    ruleset: entity 
                ];
                def opener = InvokerUtil.lookupOpener('rulegroup:create', params); 
                if (opener) opener.target = 'popup';
                
                return opener;
            } 
                        
            private boolean removeRulegroupImpl() {
                if (MsgBox.confirm('You are about to remove the selected item. Continue?')) {
                    service.removeEntity(selectedRulegroup); 
                    entity.rulegroups.remove(selectedRulegroup);
                    return true;                     
                } else {
                    return false; 
                } 
            } 
        }
   ]]>
   </code>
   
   <pages>
       <page template="com.rameses.rules.dev.RuleGroupsPage"/>
   </pages>
</workunit>