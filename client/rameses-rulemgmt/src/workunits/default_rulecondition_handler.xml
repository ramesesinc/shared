<workunit>
    <invokers>
        <invoker type="default-rulecondition-handler:create" caption="Rule Condition" action="create" target="popup"/>
        <invoker type="default-rulecondition-handler:open" caption="Rule Condition" action="open" target="popup"/>
    </invokers>
   
    <code>
    <![CDATA[
        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import com.rameses.rules.helpers.*;

        class RuleFactController {
            @Binding
            def binding;
        
            //feed by the caller 
            def condition, rulefact;
            
            def selectedField;
            def selectedConstraint;
            def constraint = [:];
            
            @PropertyChangeListener 
            def listener = [
                selectedField: {o-> 
                    constraint.fieldname = o?.name; 
                    constraint.fieldtype = o?.type;
                } 
            ]; 
            
            void create() { 
                if (!condition.constraints) condition.constraints = [];
            }
            
            void open() {
                if (!condition.constraints) condition.constraints = [];
            }
            
            def getFields() {
                return rulefact?.fields; 
            }
            
            def getOperators() {
                return OperatorList.getOperator( constraint, selectedField ); 
            } 
            
            void addConstraint() {
                constraint.displaytext = constraint.toString();
                condition.constraints << constraint;
                constraint = [:];
                selectedField = null;
                binding?.refresh('selectedConstraint');
            }
        }
   ]]>
   </code>
   
   <pages>
       <page template="com.rameses.rules.ui.RuleConditionPage"/>
   </pages>
</workunit>