<workunit>
    <invokers>
        <invoker type="conditionvaluehandler:lov" action="init"/>
    </invokers>
    <code>
         <![CDATA[    

        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import com.rameses.rules.helpers.*;
        
        class LovConditionValueHandler {
        
            @Binding
            def binding;
        
            def constraint;
            def fieldDef;
            def key;
            def multi;
            
            void init() {
                key = constraint.datatype.split(":")[1];
                multi = (constraint.operator.multi == true)?true:false;
            }
            
            def viewValueOpener() {
                def params = [:];
                params.key = key;
                params.multiSelect = multi;
                if(multi == true ) {
                    params.multiSelectHandler = { o->
                        if(!constraint.value) return false;
                        return (constraint.value.find{ o.key == it }!=null);
                    };
                    params.onselect = { val->
                        constraint.valueText = val.join(",");
                        constraint.value = val;
                        binding.refresh();
                    };
                }
                else {
                    params.onselect = { val-> 
                        constraint.valueText = val; 
                        constraint.value = val; 
                        binding.refresh(); 
                    }; 
                }
                return InvokerUtil.lookupOpener( "lov:lookup", params );
            }
        }
        
        ]]>
        
    </code>
    
    <pages>
        <page name="default" template="com.rameses.rules.constraints.ui.ObjectHandler"/>
    </pages>
    
</workunit>