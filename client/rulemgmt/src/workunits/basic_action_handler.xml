<workunit>
    
    <invokers>
        <invoker type="actionhandler:basic" action="init"/>
    </invokers>

    <!--
    notes: action parameter handlers must:
    implement
    -->
    <code>
        <![CDATA[    

        import com.rameses.rcp.annotations.*;
        import com.rameses.rcp.common.*;
        import com.rameses.osiris2.client.*;
        import com.rameses.osiris2.common.*;
        import com.rameses.rules.helpers.*;
         
        class BasicActionHandler  {
        
            @Binding
            def binding;
            
            //caller-supplied variables
            def rule;
            def action;
            def actionDef;
            def varList;
            def saveHandler;
            
            def init() {
            }
            
            def formParams = [
                getFormControls: {
                    def list = [];
                    actionDef.params.each { p->
                        if(!action.params[p.name]) action.params[p.name] = [:];
                        action.params[p.name].datatype = p.datatype;
                        
                        def props = [:];
                        props.caption = (p.caption)?p.caption:p.name;
                        props.putAll(p);
                        
                        if( props.datatype.matches("decimal|integer|string") && !p.expression) {
                            props.name = "action.params."+p.name+".value";
                            String control = props.datatype;
                            if(control=="string") control = "text";
                            list <<  new FormControl(control, props );
                        }
                        else {
                            def opener = null;
                            if( props.usevar == true ) {
                                opener = "vars";
                            }    
                            else if( p.expression == true ) {
                                opener="expression";
                            }    
                            else if( props.datatype.startsWith("lov")) {
                                opener ="lov";
                            }    
                            else {
                                opener = "object";
                            }    
                            props.actionParam = action.params[p.name];
                            props.vars = varList;
                            props.handlerObject = InvokerUtil.lookupOpener("actionvaluehandler:"+opener, props);
                            list <<  new FormControl("subform", props );                 
                        }
                    }
                    return list;
                },
            ] as FormPanelModel;
            
            def doCancel() {
                 if(MsgBox.confirm('Discard changes?')) {
                    return "_close:_close";
                }
            }
            
            def doOk() {
                action.text = action.toString();
                saveHandler(action);
                return "_close:_close";
            }
            
            void viewAction() {
                MsgBox.alert( action );
            }
            
        }
        
        ]]>
        
    </code>
    
    <pages>
        <page name="default" template="com.rameses.rules.ui.RuleActionPage"/>
    </pages>
    
</workunit>