<workunit>
    
    <invokers>
        <invoker type="bpls:updategross" action="start" target="self"/> 
        <invoker folderid="/explorer/txn/bpls" 
            caption="Update Gross for New Business" action="start" target="window" index="6"/>
    </invokers>
    
    <code>
         <![CDATA[    
        import com.rameses.rcp.annotations.*
        import com.rameses.rcp.common.*
        import com.rameses.osiris2.client.*
        import com.rameses.osiris2.common.*
        import etracs2.bpls.application.*;
        
        class UpdateQtrGrossController extends AbstractSearchBplsApplication {
            public def findApplication(def o) {
                def app = [lobs:[], infos:[] ];
                app.txntype = "RENEW";
                app.controlno = "BP001";
                app.txnmode = "ONLINE";
                app.iyear = 2013;
                app.docstate = "CLOSED";
                app.txndate = "2013-01-01";
                app.permiteename ="NAZARENO, ELMO";
                app.permiteeaddress ="CEBU CITY";
                app.tradename ="RAMESES SYSTEMS INC.";
                app.businessaddress = "CAPITOL, CEBU CITY";
                app.lobs << [objid:'L1', title:'SARI-SARI STORE', assessmenttype:"NEW"];
                app.lobs <<[objid:'L2', title:'BAKESHOP', assessmenttype:"NEW"];
                app.infos << [type:'decimal',caption:'POLICE FEE',level:0, value:150];
                app.infos << [lobid: 'L1', type:'decimal',caption:'CAPITAL',level:0, value:25000];
                app.infos << [lobid: 'L2', type:'integer',caption:'NUM_EMPLOYEES',level:0,value:3];
                return app;
            }
            
            void initInfos() {
                editableInfos.clear();
                application.lobs.findAll{ it.assessmenttype == 'NEW' }.each {
                    editableInfos << [lobid: it.objid, type:'decimal',caption:'GROSS (Q2)', qtr:2, level:0];
                    editableInfos << [lobid: it.objid, type:'integer',caption:'GROSS (Q3)', qtr:3, level:0];
                }
            }
        }
        ]]>
        
    </code>
    <pageflow>
        <start>
            <transition cond="#{application==null}" to="search"/>
            <transition cond="#{application!=null}" to="view" action="initInfos"/>
        </start>
        <page name="search" title="Search Business Application for Renewal">
            <transition to="end" caption="Close"/>
            <transition to="view" caption="Next" immediate="false" action="initInfos"/>
        </page>
        <page name="view" title="Update Qtr Gross for New Business">
            <transition to="end" name="a" caption="Back" tag="reset"/>
            <transition to="end" name="b" caption="Next" tag="proceed"/>
            <transition to="end" name="c" caption="Close"/>
        </page>
        <end/>
    </pageflow>
    
    <pages>
        <page name="search" template="etracs2.bpls.application.SearchApplicationPage" />
        <page name="view" template="etracs2.bpls.application.SpecifyInfoPage" />
    </pages>
    
</workunit>
