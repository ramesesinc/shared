<workunit>
    <invokers>
        <invoker type="quick_launcher" code="BNKA01" action="create" caption="Bank Account" role="MASTER_ENCODER" permission="bankacct.create" target="window" />
        <invoker type="bankacct:create" action="init" caption="Bank Account"/>
        <invoker type="bankacct:open" action="open" caption="Bank Account"/>
    </invokers>
    <code>
        <![CDATA[
            import com.rameses.rcp.common.*;
            import com.rameses.rcp.annotations.*;
            import com.rameses.osiris2.client.*;
            import com.rameses.osiris2.common.*

            class BankAcctController extends CRUDController {   
                @Service('BankAcctMasterService')
                def bankAcctMasterSvc

                @Service('BankAcctListService')
                def bankAcctListSvc

                @Service('FundListService')
                def fundListSvc

                def fund
                def bank

                String serviceName = 'BankAcctMasterService'
                String entityName  = 'bankacct'
                String prefixId = 'B'
                String getCreateFocusComponent() { return 'entity.acctno' }
                String getEditFocusComponent() { return 'entity.acctno' }
                
                public void save() {
                    if( fund ) {
                        entity.fundid = fund.objid
                        entity.fund = fund.fundname
                    }
                    if( bank ) {
                        entity.bankid = bank.objid
                        entity.bank_code = bank.code
                        entity.bank_name = bank.name
                        entity.branchname = bank.branchname
                    }
                    super.save()
                }
                
                void open() {
                    super.open()
                    fund = funds.find{ it.objid == entity.fundid }
                    bank = bankAcctMasterSvc.getBankById( entity )
                }

                def getAccttypes() {
                    return bankAcctListSvc.getAccountTypeList()
                }

                def getFunds() {
                    return fundListSvc.getList([_start:0, _limit:50])
                }
                
                def onselect = { 
                    bank = it 
                    binding.refresh('bank.name')
                    binding.refresh('bank.branchname')
                }
                def lookupBank = InvokerUtil.lookupOpener('bank:lookup', [onselect:onselect]);
                
                List getCurrencylist() {
                    return ['PHP','DOLLAR']
                }
            }
        ]]>
    </code>
    <pages>
        <page template="com.rameses.enterprise.treasury.master.BankAcctPage"/>
    </pages>
</workunit>